{"ast":null,"code":"import _regeneratorRuntime from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/karina/Desktop/projects/jpdraws/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import{CardElement,injectStripe}from'react-stripe-elements';var CheckoutForm=/*#__PURE__*/function(_Component){_inherits(CheckoutForm,_Component);function CheckoutForm(props){var _this;_classCallCheck(this,CheckoutForm);_this=_possibleConstructorReturn(this,_getPrototypeOf(CheckoutForm).call(this,props));_this.handleChange=function(event){_this.setState(_defineProperty({},event.target.name,event.target.value));};_this.handleSubmit=function _callee(event){var _ref,token,amount,response;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();console.log(\"1\");_context.prev=2;_context.next=5;return _regeneratorRuntime.awrap(_this.props.stripe.createToken({name:_this.state.name}));case 5:_ref=_context.sent;token=_ref.token;amount=_this.state.amount;console.log(\"2\",token,amount);_context.next=11;return _regeneratorRuntime.awrap(fetch('http://localhost:9000/charge',{method:'POST',headers:{\"Content-Type\":\"text/plain\"},body:token.id+\"&\"+amount}));case 11:response=_context.sent;console.log(\"3\",response);if(response.ok){_this.setState({complete:true});_this.props.cart.forEach(function(item){var user_id=_this.props.user.id;var drawing_id=item.id;fetch('/api/v1/transactions',{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify({user_id:user_id,drawing_id:drawing_id})}).then(function(res){return res.json();}).then(function(data){_this.props.getUser();});});};// redirect, clear inputs, thank alert\n_context.next=20;break;case 17:_context.prev=17;_context.t0=_context[\"catch\"](2);throw _context.t0;case 20:case\"end\":return _context.stop();}}},null,null,[[2,17]]);};_this.state={complete:false,name:\"\",amount:_this.props.totalAmount(_this.props.cart)};return _this;}_createClass(CheckoutForm,[{key:\"render\",value:function render(){if(this.state.complete)return React.createElement(\"h1\",null,\"Purchase Complete\");return React.createElement(\"main\",null,React.createElement(\"form\",{onSubmit:this.handleSubmit},React.createElement(\"input\",{type:\"text\",value:this.state.name,name:\"name\",placeholder:\"Full Name\",onChange:this.handleChange}),React.createElement(CardElement,{className:\"cardElement\"}),React.createElement(\"input\",{type:\"submit\",value:\"Purchase\",className:\"btn-item\"})));}}]);return CheckoutForm;}(Component);export default injectStripe(CheckoutForm);","map":{"version":3,"sources":["/Users/karina/Desktop/projects/jpdraws/client/src/client/components/CheckoutForm.js"],"names":["React","Component","CardElement","injectStripe","CheckoutForm","props","handleChange","event","setState","target","name","value","handleSubmit","preventDefault","console","log","stripe","createToken","state","token","amount","fetch","method","headers","body","id","response","ok","complete","cart","forEach","item","user_id","user","drawing_id","JSON","stringify","then","res","json","data","getUser","totalAmount"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport {CardElement, injectStripe} from 'react-stripe-elements';\n\nclass CheckoutForm extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      complete: false,\n      name: \"\",\n      amount: this.props.totalAmount(this.props.cart)\n    }\n  }\n\n  handleChange = (event) => {\n    this.setState({\n      [event.target.name]: event.target.value\n    })\n  }\n\n  handleSubmit = async (event) => {\n    event.preventDefault()\n    console.log(\"1\")\n    try {\n      let { token } = await this.props.stripe.createToken({ name: this.state.name })\n      let amount = this.state.amount\n      console.log(\"2\", token, amount)\n      let response = await fetch('http://localhost:9000/charge', {\n        method: 'POST',\n        headers: {\n          \"Content-Type\": \"text/plain\"\n        },\n        body: token.id + \"&\" + amount\n      })\n      console.log(\"3\", response)\n      if (response.ok) {\n        this.setState({complete: true})\n        this.props.cart.forEach((item) => {\n          let user_id = this.props.user.id\n          let drawing_id = item.id\n          fetch('/api/v1/transactions', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json'\n            },\n            body: JSON.stringify({\n              user_id,\n              drawing_id\n            })\n          })\n          .then(res => res.json())\n          .then(data => {\n            this.props.getUser()\n          })\n        })\n      };\n      // redirect, clear inputs, thank alert\n    } catch (event) {\n      throw event\n    }\n  }\n\n  render(){\n    if (this.state.complete) return <h1>Purchase Complete</h1>;\n    return (\n      <main>\n        <form onSubmit={ this.handleSubmit }>\n          <input\n            type=\"text\"\n            value={ this.state.name }\n            name=\"name\"\n            placeholder=\"Full Name\"\n            onChange={ this.handleChange }\n          />\n        <CardElement className=\"cardElement\" />\n          <input type=\"submit\" value=\"Purchase\" className=\"btn-item\"/>\n        </form>\n      </main>\n\n    )\n  }\n}\n\nexport default injectStripe(CheckoutForm);\n"]},"metadata":{},"sourceType":"module"}